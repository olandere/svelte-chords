<div class="container-fluid">
  <h1>Chord charts - beta</h1>
  <!--form novalidate class="form-inline" -->
  <label title="Examples: CM7, Aadd9, F&#x266f;m7&#x266d;5, x 0 2 2 1 0">Chord:
    <input type="text"
           id="chordInput"
           class="form-control"
           bind:value='chordName'
           placeholder="Enter chord(s) here"
           required>
  </label>
  <label title="">Fret span: <input type="number"
                                    class="form-control"
                                    bind:value='fretSpan'
                                    value="4"
                                    placeholder="4"
                                    min="1"
                                    max="12"></label>
  <div class="form-group">
    <label>Tuning: </label>
    <Tuning></Tuning>
  </div>
  <div class="checkbox">
    <label>
      <input type="checkbox">Shell
    </label>
  </div>
  <div class="checkbox">
    <label>
      <input type="checkbox">Condense
    </label>
  </div>
  <div class="checkbox">
    <label>
      <input type="checkbox">Jazz voicings only
    </label>
  </div>
  <input id="submitButton" type="button" class="btn btn-primary" value="Submit" on:click="handleSubmit(event)"/>
  <a href="help.html">How do I use this???</a>
  <!--/form-->
  <hr>
  <div id="chordlist">
    <!--ChordList ref:chordlist /-->
  </div>
</div>
<script>

  import ChordList from './ChordList.html';
  import ChordService from './ChordService';
  import Tuning from './Tuning.html';
  import './app.css';
  import 'bootstrap';
  import 'bootstrap/dist/css/bootstrap.css';

  export default {
    data() {
      return {
        fretSpan: 4,
        chordName: ''
      };
    },
    components: {
      ChordList,
      Tuning
    },
    oncreate() {
      // Component initialization happens here, see
      const cs = new ChordService("http://default-environment-bi6eqhhyfr.elasticbeanstalk.com");
      this.set({cs: cs});
      document.getElementById("chordInput")
        .addEventListener("keyup", function(event) {
          event.preventDefault();
          if (event.keyCode == 13) {
            document.getElementById("submitButton").click();
          }
        });
    },
    methods: {
      handleSubmit: function (event) {
        const _this = this;

        function renderChords(chords) {
          if (_this.chordlist) {
            _this.chordlist.destroy();
          }
          _this.chordlist = new ChordList({
            target: document.getElementById('chordlist')
          });
          _this.chordlist.set({chords: chords});
        }

        const firstChar = _this.get('chordName').trim().charAt(0);
        if (firstChar.match(/[abcdefgrs]/i)) {
          _this.get('cs').chords(this.get('fretSpan'), _this.get('chordName'),
            'EADGBE', false, false).then(chords => {
            renderChords(chords);
          })
        } else {
          _this.get('cs').analyze(_this.get('chordName'),
            'EADGBE').then(chords => {
            renderChords(chords);
          })
        }
      }
    }
  };

</script>
